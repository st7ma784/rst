# Standalone makefile for fitacf 3.0 - Array-Based Implementation
# This makefile works without RST environment variables
#
# Usage: make -f makefile_standalone [target]

# Compiler settings
CC = gcc
AR = ar
ARFLAGS = ruv
CFLAGS = -Wall -O2 -std=c99
LIBS = -lm

# Compiler flags for parallel processing
OPENMP_FLAGS = -fopenmp
OPTIMIZATION_FLAGS = -O3 -march=native -ftree-vectorize
DEBUG_FLAGS = -g -DDEBUG_ARRAY
ARRAY_FLAGS = -DUSE_ARRAY_IMPLEMENTATION

# Include paths - only local includes
INCLUDE = -I../include -I.

# Create lib directory if it doesn't exist
LIBPATH = ../lib
$(shell mkdir -p $(LIBPATH))

# Source files (we'll build minimal test versions only)
SRC_TEST_BASELINE = ../test/test_fitacf_comprehensive.c
SRC_TEST_COMPARISON = ../test/test_array_vs_llist.c  
SRC_TEST_PERFORMANCE = ../test/test_fitacf_performance_comprehensive.c

# Test executables
TEST_BASELINE = test_baseline
TEST_COMPARISON = test_comparison
TEST_PERFORMANCE = test_performance

# Default target - build all tests
all: tests

tests: $(TEST_BASELINE) $(TEST_COMPARISON) $(TEST_PERFORMANCE)

# Baseline test (standalone)
$(TEST_BASELINE): $(SRC_TEST_BASELINE)
	$(CC) $(CFLAGS) $(INCLUDE) -o $(TEST_BASELINE) $(SRC_TEST_BASELINE) $(LIBS)
	@echo "Built baseline test: $(TEST_BASELINE)"

# Comparison test (with OpenMP)
$(TEST_COMPARISON): $(SRC_TEST_COMPARISON)
	$(CC) $(CFLAGS) $(OPENMP_FLAGS) $(ARRAY_FLAGS) $(INCLUDE) \
		-o $(TEST_COMPARISON) $(SRC_TEST_COMPARISON) $(LIBS)
	@echo "Built comparison test: $(TEST_COMPARISON)"

# Performance test (with OpenMP and optimizations)
$(TEST_PERFORMANCE): $(SRC_TEST_PERFORMANCE)
	$(CC) $(CFLAGS) $(OPENMP_FLAGS) $(OPTIMIZATION_FLAGS) $(ARRAY_FLAGS) $(INCLUDE) \
		-o $(TEST_PERFORMANCE) $(SRC_TEST_PERFORMANCE) $(LIBS)
	@echo "Built performance test: $(TEST_PERFORMANCE)"

# Clean target
clean:
	rm -f $(TEST_BASELINE) $(TEST_COMPARISON) $(TEST_PERFORMANCE)
	@echo "Cleaned test executables"

# Help target
help:
	@echo "Standalone FitACF v3.0 Test Build"
	@echo "Available targets:"
	@echo "  all               - Build all test programs"
	@echo "  $(TEST_BASELINE)     - Build baseline test"
	@echo "  $(TEST_COMPARISON)   - Build comparison test" 
	@echo "  $(TEST_PERFORMANCE)  - Build performance test"
	@echo "  clean             - Remove test executables"
	@echo "  help              - Show this help"
	@echo ""
	@echo "Usage: make -f makefile_standalone [target]"

# Test targets for convenience
test_baseline: $(TEST_BASELINE)
test_comparison: $(TEST_COMPARISON)
test_performance: $(TEST_PERFORMANCE)

# Phony targets
.PHONY: all tests clean help test_baseline test_comparison test_performance
